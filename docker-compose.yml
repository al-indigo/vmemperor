version: '3'
services:
  influxdb:
    image: influxdb/influxdb
    networks:
      - influxdb
  grafana:
    image: grafana/grafana
    depends_on:
      - influxdb
    volumes:
      - ./configs/grafana/provisioning/:/etc/grafana/provisioning
      - ./configs/grafana/public:/usr/share/grafana/public
      - ./configs/grafana/grafana.ini:/etc/grafana/grafana.ini
    networks:
      - influxdb
      - backend


  rethinkdb:
    image: rethinkdb:latest
    networks:
      - backend
  vmemperor:
    build: .
    volumes:
      - ./configs/login.ini:/app/login.ini
      - ./keys:/root/.ssh
    ports:
      - 8889:8889
    networks:
      - backend
    depends_on:
      - rethinkdb
      - grafana


  nginx:
    image: nginx:1.13
    ports:
      - 80:80
    volumes:
      - ./configs/nginx.conf:/etc/nginx/nginx.conf
    networks:
      - backend

    depends_on:
      - vmemperor

networks:
  backend:
    driver: bridge
  influxdb:
    driver: bridge
